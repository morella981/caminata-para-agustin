<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Una caminata para Agustín</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
  background: linear-gradient(#f6b7d2, #cbb7f6, #9ecbff);
}
canvas { display: block; }

#overlay {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.35);
}

#dialog {
  background: white;
  padding: 25px;
  border-radius: 20px;
  max-width: 420px;
  text-align: center;
  font-size: 18px;
  animation: pop .3s ease;
}

button {
  margin-top: 20px;
  padding: 10px 25px;
  border: none;
  border-radius: 20px;
  background: #f6b7d2;
  font-size: 16px;
  cursor: pointer;
}

@keyframes pop {
  from { transform: scale(.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="overlay">
  <div id="dialog">
    <div id="dialogText"></div>
    <button onclick="closeDialog()">Cerrar</button>
  </div>
</div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/audio/2022/10/03/audio_5f4b6a8e0f.mp3">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const music = document.getElementById("music");
music.volume = 0.35;
music.play();

let camY = 0;
let camX = 0;
let speed = 2;

const player = {
  x: 50,
  y: canvas.height - 140,
  birds: []
};

const you = {
  x: 4300,
  y: canvas.height - 140,
  active: false
};

const cards = [
  { x: 600,  text: "Hola mi amor, espero que disfrutes esta caminata :)", color:"#ffd1dc" },
  { x: 1200, text: "Ojalá no te empaches con los chocolates de hoy", color:"#c1e1c1" },
  { x: 1800, text: "Sos el chico mas lindo hasta en formato 2D", color:"#cddafd" },
  { x: 2400, text: "Se te acumulan los pajaritos, ya pensaste un nombre para cada uno?", color:"#fdf1c7" },
  { x: 3000, text: "Apurate que te estoy esperando!!", color:"#e3c6ff" },
  { x: 3600, text: "Ya casi me encontrás, besitoo", color:"#ffd6a5" }
];

let currentCard = null;
let finalStage = false;
let hugging = false;
let ending = false;

function ground() {
  ctx.fillStyle = "#9ed3a5";
  ctx.fillRect(0, canvas.height-100-camY, canvas.width, 100);
  ctx.fillStyle = "#b88855";
  ctx.fillRect(0, canvas.height-70-camY, canvas.width, 70);
}

function drawPlayer(x,y,shirtA,shirtB,hair,eyes) {
  ctx.save();
  ctx.translate(x-camX,y-camY);
  ctx.fillStyle = "#ffe0cc";
  ctx.beginPath();
  ctx.arc(0,0,18,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = hair;
  ctx.fillRect(-18,-18,36,8);
  ctx.fillStyle = eyes;
  ctx.fillRect(-6,-2,3,3);
  ctx.fillRect(3,-2,3,3);
  ctx.fillStyle = shirtA;
  ctx.fillRect(-15,20,30,12);
  ctx.fillStyle = shirtB;
  ctx.fillRect(-15,32,30,12);
  ctx.restore();
}

function drawCards() {
  cards.forEach(c=>{
    if(!c.collected){
      ctx.fillStyle = c.color;
      ctx.fillRect(c.x-camX, canvas.height-140-camY, 28, 38);
    }
  });
}

function drawBirds() {
  player.birds.forEach((b,i)=>{
    b.angle += 0.02;
    b.x = player.x + Math.cos(b.angle)*(30+10*i);
    b.y = player.y - 40 + Math.sin(b.angle)*(10+5*i);
    ctx.fillStyle = b.color;
    ctx.beginPath();
    ctx.arc(b.x-camX, b.y-camY, 6, 0, Math.PI*2);
    ctx.fill();
  });
}

function openDialog(text) {
  document.getElementById("dialogText").innerText = text;
  document.getElementById("overlay").style.display = "flex";
}

function closeDialog() {
  document.getElementById("overlay").style.display = "none";
  if(finalStage && !hugging){
    hugging = true;
  }
}

window.addEventListener("click", ()=>{
  if(!finalStage && !ending) player.x += speed*12;
});

function update() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  camX = player.x - 150;

  ground();
  drawCards();
  drawBirds();

  drawPlayer(player.x, player.y, "#87c9ff","#ffe066","#c68642","#a56b2c");

  if(player.x > 4000){
    drawPlayer(you.x, you.y, "#f6b7d2","#ffffff","#f3d27c","#6fa86f");
    if(!finalStage){
      finalStage = true;
      openDialog("¡¡Me encontraste!! Gracias por buscarme, bancarme y elegirme durante estos 3 años y medio.\n\nSos el mejor novio del universo Agustin, te amo con el alma <3");
    }
  }

  cards.forEach(c=>{
    if(!c.collected && Math.abs(player.x-c.x)<20){
      openDialog(c.text);
      c.collected=true;
      player.birds.push({color:c.color, angle:Math.random()*Math.PI*2});
    }
  });

  if(hugging && !ending){
    player.x += (you.x-20-player.x)*0.05;
    if(Math.abs(player.x-you.x)<5){
      ending=true;
    }
  }

  if(ending){
    camY += 0.6;
    ctx.fillStyle="rgba(255,200,220,0.8)";
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2-100, 120,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#fff";
    ctx.font="28px Arial Rounded MT Bold";
    ctx.textAlign="center";
    ctx.fillText("Feliz San Valentín", canvas.width/2, canvas.height/2-110);
    ctx.fillText("Te amo", canvas.width/2, canvas.height/2-70);
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
