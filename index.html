<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Caminata para Agustín</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; image-rendering: pixelated; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// IMÁGENES
const agustin = new Image(); agustin.src = "agustin.png";
const morella = new Image(); morella.src = "morella.png";
const corazonImg = new Image(); corazonImg.src = "corazon.png";

// JUGADOR
const player = { x:100, y:0, w:64, h:64, speed:4 };
const groundY = canvas.height - 100;
player.y = groundY - player.h + 8;

// CARTAS
const cartas = [
 {x:500,color:"#ffd1dc",texto:"Hola mi amor,\nespero que disfrutes\nesta caminata :)"},
 {x:900,color:"#d1e8ff",texto:"Ojalá no te empaches\ncon los chocolates\nde hoy"},
 {x:1300,color:"#e8d1ff",texto:"Sos el chico más\nlindo hasta en\nformato 2D"},
 {x:1700,color:"#d1ffe3",texto:"Se te acumulan\nlos pajaritos,\nya pensaste un nombre\npara cada uno?"},
 {x:2100,color:"#fff3d1",texto:"Apurate que te\nestoy esperando!!"},
 {x:2500,color:"#ffd1f0",texto:"Ya casi me encontrás,\nbesitoo"}
];

let cartaAbierta=null;

// PAJAROS
const pajaros=[];

// MORELLA
const morellaX = 3100;
let dialogoFinal=false;
let abrazo=false;
let camY=0;
let finalActivo=false;
let tiempoFinal=0;

// INPUT
const keys={};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);
canvas.addEventListener("click",()=>{
  if(Math.abs(player.x-morellaX)<80 && !dialogoFinal && !abrazo)
    dialogoFinal=true;
});

// TEXTO
function drawBox(text){
 const boxX=canvas.width/2-300;
 const boxY=canvas.height/2-180;
 ctx.fillStyle="#fff";
 ctx.fillRect(boxX,boxY,600,280);
 ctx.strokeStyle="#e6b7d6";
 ctx.strokeRect(boxX,boxY,600,280);

 ctx.fillStyle="#444";
 ctx.font="20px Trebuchet MS";
 text.split("\n").forEach((l,i)=>{
   ctx.fillText(l,boxX+60,boxY+70+i*28);
 });

 ctx.font="14px sans-serif";
 ctx.fillText("ENTER para cerrar",boxX+220,boxY+240);
}

// UPDATE
function update(){
 if(!cartaAbierta && !dialogoFinal && !abrazo){
   if(keys["ArrowRight"]) player.x+=player.speed;
   if(keys["ArrowLeft"]) player.x-=player.speed;
 }

 cartas.forEach(c=>{
   if(!c.tomada && !cartaAbierta && Math.abs(player.x-c.x)<30){
     cartaAbierta=c;
   }
 });

 if(cartaAbierta && keys["Enter"]){
   cartaAbierta.tomada=true;
   pajaros.push({x:player.x-20,y:player.y});
   cartaAbierta=null;
 }

 // Movimiento fluido de pajaros
 pajaros.forEach((p,i)=>{
   const targetX = i===0 ? player.x-25 : pajaros[i-1].x-18;
   const targetY = player.y + 10;
   p.x += (targetX - p.x)*0.1;
   p.y += (targetY - p.y)*0.1;
 });

 if(Math.abs(player.x-morellaX)<60 && !dialogoFinal && !abrazo){
   player.speed=0;
 }

 if(dialogoFinal && keys["Enter"]){
   dialogoFinal=false;
   abrazo=true;
 }

 if(abrazo){
   if(player.x<morellaX-70) player.x+=1;
   else{
     finalActivo=true;
     if(tiempoFinal===0) tiempoFinal=Date.now();
   }
 }

 if(finalActivo){
   if(Date.now() - tiempoFinal < 3000){
     camY += 2;
   }
 }
}

// DIBUJOS EXTRA
function drawCloud(x,y){
 ctx.fillStyle="#fff";
 ctx.fillRect(x,y,60,20);
 ctx.fillRect(x+10,y-10,40,20);
 ctx.fillRect(x+20,y-20,30,20);
}

function drawTree(x){
 ctx.fillStyle="#b58b6a";
 ctx.fillRect(x,groundY-50,20,50);
 ctx.fillStyle="#a8d5ba";
 ctx.fillRect(x-20,groundY-80,60,40);
}

// DRAW
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 const camX=Math.max(player.x-200,0);

 // CIELO
 const g=ctx.createLinearGradient(0,0,0,canvas.height);
 g.addColorStop(0,"#f6b1c3");
 g.addColorStop(.5,"#d6c1f0");
 g.addColorStop(1,"#9fd3ff");
 ctx.fillStyle=g;
 ctx.fillRect(0,camY - canvas.height,canvas.width,canvas.height*3);

 // NUBES
 for(let i=0;i<5;i++)
   drawCloud(200+i*400-camX,120+i*20+camY);

 // SUELO
 ctx.fillStyle="#7c9c6c";
 ctx.fillRect(0,groundY+camY,canvas.width,100);

 // ÁRBOLES
 for(let i=0;i<6;i++)
   drawTree(300+i*500-camX);

 // CARTAS
 cartas.forEach(c=>{
   if(!c.tomada){
     ctx.fillStyle=c.color;
     ctx.fillRect(c.x-camX,groundY-30+camY,22,30);
   }
 });

 // PAJAROS
 pajaros.forEach(p=>{
   ctx.fillStyle="#fff";
   ctx.beginPath();
   ctx.moveTo(p.x-camX,p.y+camY);
   ctx.lineTo(p.x-6-camX,p.y+6+camY);
   ctx.lineTo(p.x+6-camX,p.y+6+camY);
   ctx.closePath();
   ctx.fill();
 });

 // PERSONAJES
 ctx.drawImage(agustin,player.x-camX,player.y+camY,64,64);
 ctx.drawImage(morella,morellaX-camX,player.y+camY,64,64);

 if(cartaAbierta) drawBox(cartaAbierta.texto);

 if(dialogoFinal)
   drawBox("¡¡Me encontraste!!\nGracias por buscarme, bancarme\ny elegirme durante estos 3 años\ny medio. Sos el mejor novio\ndel universo Agustin,\nte amo con el alma <3");

 // FINAL: CORAZÓN PALPITANDO
 if(camY > canvas.height * 0.3){
   const latido = 1 + Math.sin(Date.now() * 0.005) * 0.05;

   const w = canvas.width * 0.9 * latido;
   const h = canvas.height * 0.9 * latido;

   ctx.drawImage(
     corazonImg,
     canvas.width/2 - w/2,
     canvas.height/2 - h/2,
     w,
     h
   );
 }
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>

</body>
</html>
